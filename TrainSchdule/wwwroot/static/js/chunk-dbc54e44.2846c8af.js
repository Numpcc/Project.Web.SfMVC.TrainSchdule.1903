(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-dbc54e44"],{"96d1":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"application-examine ma-4"},[a("el-row",[a("el-col",{attrs:{lg:8,md:16,sm:24}},[a("el-card",{staticClass:"elevation-0",attrs:{shadow:"hover"}},[a("el-form",{ref:"queryForm",attrs:{model:e.queryForm}},[a("el-row",[a("el-col",{staticClass:"mb-3",attrs:{md:24,sm:12}},[a("div",{staticClass:"py-2 body-2 layout align-center row justify-space-between"},[e._v("\n                单位\n                "),a("el-button",{attrs:{circle:"",icon:"el-icon-refresh",size:"mini",type:"primary"},on:{click:e.getOnMyManage}})],1),e._v(" "),a("el-select",{staticClass:"full-width",attrs:{placeholder:"选择管辖单位"},on:{change:e.companyChanged},model:{value:e.queryForm.companyCode,callback:function(t){e.$set(e.queryForm,"companyCode",t)},expression:"queryForm.companyCode"}},[a("el-option",{attrs:{label:"--全部--",value:""}}),e._v(" "),e._l(e.myManages,(function(e){return a("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})}))],2)],1),e._v(" "),a("el-col",{staticClass:"mb-3",attrs:{md:24,sm:12}},[a("div",{staticClass:"py-2 body-2 layout align-center row justify-space-between"},[e._v("\n                指定人员\n                "),a("el-switch",{model:{value:e.queryForm.isSearchUser,callback:function(t){e.$set(e.queryForm,"isSearchUser",t)},expression:"queryForm.isSearchUser"}})],1),e._v(" "),a("el-select",{directives:[{name:"show",rawName:"v-show",value:e.queryForm.isSearchUser,expression:"queryForm.isSearchUser"}],staticClass:"full-width",attrs:{placeholder:""},model:{value:e.queryForm.userId,callback:function(t){e.$set(e.queryForm,"userId",t)},expression:"queryForm.userId"}},[a("el-option",{attrs:{value:e.$store.state.user.userid,label:"查我自己"}}),e._v(" "),e._l(e.membersOption,(function(e){return a("el-option",{key:e.id,attrs:{label:e.realName,value:e.id}})}))],2)],1),e._v(" "),a("el-col",{staticClass:"py-2",attrs:{span:24}},[a("el-button",{staticClass:"full-width",attrs:{type:"primary"},on:{click:e.searchData}},[e._v("查询")])],1)],1)],1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{lg:24,md:24,sm:24}},[a("ApplicationList",{attrs:{"data-list":e.dataList,"on-loading":e.onLoading},on:{refresh:e.searchData},scopedSlots:e._u([{key:"action",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.auditApply(r,1)}}},[e._v("通过")]),e._v(" "),"publish"!=r.status?a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.auditApply(r,2)}}},[e._v("驳回")]):e._e(),e._v(" "),"deleted"!=r.status?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.DeleteApply(r)}}},[e._v("删除")]):e._e()]}}])},[a("template",{slot:"headeraction"},[e.queryForm.isSearchUser?a("el-button",{attrs:{icon:"el-icon-download",type:"primary"},on:{click:function(t){return e.exportUserApplies({user:e.queryForm.userId})}}},[e._v("导出用户申请")]):a("el-button",{attrs:{icon:"el-icon-download",type:"primary"},on:{click:function(t){return e.exportCompanyApplies({company:e.queryForm.companyCode})}}},[e._v("导出单位申请")])],1)],2),e._v(" "),a("el-dialog",{attrs:{visible:e.auditForm.show,title:"提交审核",width:"30%"}},[a("el-form",{ref:"auditForm",attrs:{model:e.auditForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"审核结果"}},[a("el-switch",{staticClass:"pt-2",staticStyle:{display:"block"},attrs:{"active-value":1,"inactive-value":2,"active-color":"#13ce66","active-text":"通过","inactive-color":"#ff4949","inactive-text":"驳回"},model:{value:e.auditForm.action,callback:function(t){e.$set(e.auditForm,"action",t)},expression:"auditForm.action"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{placeholder:"请输入备注",type:"textarea"},model:{value:e.auditForm.remark,callback:function(t){e.$set(e.auditForm,"remark",t)},expression:"auditForm.remark"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"安全码"}},[a("el-input",{attrs:{placeholder:"请输入安全码"},model:{value:e.auditForm.Code,callback:function(t){e.$set(e.auditForm,"Code",t)},expression:"auditForm.Code"}})],1),e._v(" "),a("el-form-item",{attrs:{hidden:"",label:"审核人"}},[a("el-input",{attrs:{placeholder:"请输入审核人的id"},model:{value:e.auditForm.AuthByUserID,callback:function(t){e.$set(e.auditForm,"AuthByUserID",t)},expression:"auditForm.AuthByUserID"}})],1)],1),e._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.auditForm.show=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.SubmitAuditForm}},[e._v("确 定")])],1)],1)],1)],1)],1)},o=[],i=(a("bada"),a("4634"),a("48ba")),s=a("c9ee"),n=a("b8e7"),c=a("fcac"),l=a("5e24"),u={methods:{exportUserApplies:l["c"],exportApply:l["a"],exportCompanyApplies:l["b"],download:function(e){if(e){var t=window.URL.createObjectURL(new Blob([e])),a=document.createElement("a");a.style.display="none",a.href=t,a.setAttribute("download","excel.xlsx"),document.body.appendChild(a),a.click()}}}},d={name:"ApplyExamine",components:{ApplicationList:i["a"]},mixins:[u],data:function(){return{queryForm:{companyCode:"",userId:"",isSearchUser:!1},myManages:[],dataList:[],onLoading:!1,membersOption:[],cacheMembers:[],auditForm:{applyId:"",action:1,remark:"",show:!1,Code:"",AuthByUserID:""}}},computed:{myUserid:function(){return this.$store.state.user.userid}},created:function(){this.getOnMyManage()},methods:{clearAuditForm:function(){this.auditForm={applyId:"",action:1,remark:"",show:!1,Code:"",AuthByUserID:this.myUserid}},DeleteApply:function(e){var t=this,a=prompt("输入授权账号",this.myUserid);a&&Object(s["b"])({id:e.id,Auth:{AuthByUserID:a,Code:prompt("输入授权码")}}).then((function(){t.$message.success("删除成功"),t.searchData()})).catch((function(e){t.$message.error(e)}))},SubmitAuditForm:function(){var e=this,t=this.auditForm,a=t.applyId,r=t.action,o=t.remark,i=t.Code,n=t.AuthByUserID,c=[{id:a,action:r,remark:o}],l={Code:i,AuthByUserID:n};Object(s["a"])({list:c},l).then((function(t){t.forEach((function(t){0===t.status?e.$notify.success("已审批"+t.id):e.$notify.error(t.message+":"+t.id)}))})).catch((function(t){e.$message.error(t.message)})).finally((function(){e.clearAuditForm()}))},auditApply:function(e,t){this.clearAuditForm(),this.auditForm.show=!0,this.auditForm.applyId=e.id,this.auditForm.action=t},getOnMyManage:function(){var e=this;this.membersOption=[],this.cacheMembers=[],this.queryForm={companyCode:"",userId:"",isSearchUser:!1},Object(n["a"])().then((function(t){e.myManages=t.list||[]})).catch((function(e){console.warn(e)}))},companyChanged:function(e){var t=this;this.queryForm.userId="";var a=this.cacheMembers.find((function(t){return t.companyCode===e}));a?this.membersOption=a.list:Object(c["a"])({code:e}).then((function(a){a.list&&(t.membersOption=a.list,t.cacheMembers.push({companyCode:e,list:a.list}))}))},searchData:function(){var e=this;if(!0===this.onLoading)return this.$message.warning("查询中，请等候");var t=this.queryForm,a=t.isSearchUser,r=t.userId,o=t.companyCode,i=s["m"],n={code:o};a&&(i=s["n"],n.id=r),this.onLoading=!0,this.dataList=[],i(n).then((function(t){var a=t.list;e.dataList=a||[]})).finally((function(){return e.onLoading=!1}))}}},m=d,p=(a("a2fe"),a("6691")),h=Object(p["a"])(m,r,o,!1,null,"7a51a38e",null);t["default"]=h.exports},a2fe:function(e,t,a){"use strict";var r=a("c343"),o=a.n(r);o.a},c343:function(e,t,a){}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-642913b5"],{2598:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"application-list ma-4"},[a("el-row",[a("el-col",{attrs:{lg:8,md:16,sm:24}},[a("el-card",{staticClass:"elevation-0",attrs:{shadow:"hover"}},[a("el-form",{ref:"queryForm",attrs:{model:e.queryForm}},[a("el-row",[a("el-col",{staticClass:"mb-3",attrs:{md:24,sm:12}},[a("div",{staticClass:"py-2 body-2 layout align-center row justify-space-between"},[e._v("\n                单位\n                "),a("el-button",{attrs:{circle:"",icon:"el-icon-refresh",size:"mini",type:"primary"},on:{click:e.getOnMyManage}})],1),e._v(" "),a("el-select",{staticClass:"full-width",attrs:{placeholder:"选择管辖单位"},on:{change:e.companyChanged},model:{value:e.queryForm.companyCode,callback:function(t){e.$set(e.queryForm,"companyCode",t)},expression:"queryForm.companyCode"}},[a("el-option",{attrs:{label:"--全部--",value:""}}),e._v(" "),e._l(e.myManages,(function(e){return a("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})}))],2)],1),e._v(" "),a("el-col",{staticClass:"mb-3",attrs:{md:24,sm:12}},[a("div",{staticClass:"py-2 body-2 layout align-center row justify-space-between"},[e._v("\n                指定人员\n                "),a("el-switch",{model:{value:e.queryForm.isSearchUser,callback:function(t){e.$set(e.queryForm,"isSearchUser",t)},expression:"queryForm.isSearchUser"}})],1),e._v(" "),a("el-select",{directives:[{name:"show",rawName:"v-show",value:e.queryForm.isSearchUser,expression:"queryForm.isSearchUser"}],staticClass:"full-width",attrs:{placeholder:""},model:{value:e.queryForm.userId,callback:function(t){e.$set(e.queryForm,"userId",t)},expression:"queryForm.userId"}},[a("el-option",{attrs:{value:e.$store.state.user.userid,label:"查我自己"}}),e._v(" "),e._l(e.membersOption,(function(e){return a("el-option",{key:e.id,attrs:{label:e.realName,value:e.id}})}))],2)],1),e._v(" "),a("el-col",{staticClass:"py-2",attrs:{span:24}},[a("el-button",{staticClass:"full-width",attrs:{type:"primary"},on:{click:e.searchData}},[e._v("查询")])],1)],1)],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{lg:24,md:24,sm:24}},[a("ApplicationList",{attrs:{"data-list":e.dataList,"on-loading":e.onLoading},on:{refresh:e.searchData},scopedSlots:e._u([{key:"action",fn:function(t){var n=t.row,o=t.applyid;return[a("el-button",{on:{click:function(t){return e.exportApply({apply:o})}}},[e._v("导出")]),e._v(" "),a("el-dropdown",{attrs:{"split-button":"",szie:"small",trigger:"click"},on:{command:function(t){return e.hendleExecute(t,n,o)}}},[e._v("\n            操作\n            "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(["保存","撤回","发布","删除"],(function(t){return a("el-dropdown-item",{key:t,attrs:{command:t}},[e._v(e._s(t))])})),1)],1)]}}])},[a("template",{slot:"headeraction"},[a("el-button",{attrs:{icon:"el-icon-edit",type:"primary"},on:{click:e.handleCreate}},[e._v("添加")]),e._v(" "),e.queryForm.isSearchUser?a("el-button",{attrs:{icon:"el-icon-download",type:"primary"},on:{click:function(t){return e.exportUserApplies({user:e.queryForm.userId})}}},[e._v("导出用户申请")]):a("el-button",{attrs:{icon:"el-icon-download",type:"primary"},on:{click:function(t){return e.exportCompanyApplies({company:e.queryForm.companyCode})}}},[e._v("导出单位申请")])],1)],2)],1)],1)],1)},o=[],s=a("dea4"),r=(a("0b34"),a("bada"),a("48ba")),i=a("c9ee"),c=a("5e24"),l=a("b8e7"),u=a("fcac"),d={methods:{exportUserApplies:c["c"],exportApply:c["a"],exportCompanyApplies:c["b"],download:function(e){if(e){var t=window.URL.createObjectURL(new Blob([e])),a=document.createElement("a");a.style.display="none",a.href=t,a.setAttribute("download","excel.xlsx"),document.body.appendChild(a),a.click()}}}},p={name:"ApplyList",components:{ApplicationList:r["a"]},mixins:[d],data:function(){return{queryForm:{companyCode:"",userId:"",isSearchUser:!1},dataList:[],onLoading:!1,myManages:[],membersOption:[],cacheMembers:[]}},created:function(){this.getOnMyManage()},methods:{getOnMyManage:function(){var e=this;this.membersOption=[],this.cacheMembers=[],this.queryForm={companyCode:"",userId:"",isSearchUser:!1},Object(l["a"])().then((function(t){t.list&&(e.myManages=t.list||[])})).catch((function(e){console.warn(e)}))},companyChanged:function(e){var t=this,a=this.cacheMembers.find((function(t){return t.companyCode===e}));a?this.membersOption=a.list:Object(u["a"])({code:e}).then((function(a){a.list&&(t.membersOption=a.list,t.cacheMembers.push({companyCode:e,list:a.list}))}))},hendleExecute:function(e,t,a){var n=this;if(!0===this.onLoading)return!1;var o={"保存":i["k"],"撤回":i["o"],"发布":i["j"],"删除":i["b"]},r=a,c=o[e];"删除"===e&&(r={id:a,Auth:{Code:201700816,AuthByUserID:"Root"}}),this.onLoading=!0,c(r).then((function(t){if("删除"===e){var o=n.dataList.findIndex((function(e){return e.id===a}));return n.dataList.splice(o,1),n.$message.success(e+"成功"),!1}var r=t.status,i=n.dataList.find((function(e){return e.id===a}));i&&(i.status=r,n.dataList=Object(s["a"])(n.dataList)),n.$message.success(e+"成功，请求状态已改变")})).catch((function(e){console.log(e),n.$message.error("操作失败")})).finally((function(){n.onLoading=!1}))},handleCreate:function(){this.$router.push("/application/new")},searchData:function(){var e=this;if(!0===this.onLoading)return this.$message.warning("查询中，请等候");var t=this.queryForm,a=t.isSearchUser,n=t.userId,o=t.companyCode,s=i["d"],r={code:o};a&&(s=i["e"],r={id:n}),this.onLoading=!0,this.dataList=[],s(r).then((function(t){var a=t.list;e.dataList=a||[]})).finally((function(){return e.onLoading=!1}))}}},m=p,y=(a("2a8a"),a("6691")),h=Object(y["a"])(m,n,o,!1,null,"5ff98b9c",null);t["default"]=h.exports},"2a8a":function(e,t,a){"use strict";var n=a("cc28"),o=a.n(n);o.a},cc28:function(e,t,a){}}]);